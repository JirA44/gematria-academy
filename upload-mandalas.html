<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üì§ Upload Mandalas</title>
    <link rel="stylesheet" href="force-dark-mode.css">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, #1a0a2e 0%, #3d2463 50%, #6b4984 100%);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 2rem;
            color: white;
        }

        h1 {
            font-size: 3rem;
            margin-bottom: 1rem;
            text-align: center;
        }

        .subtitle {
            font-size: 1.2rem;
            opacity: 0.8;
            margin-bottom: 3rem;
            text-align: center;
        }

        .upload-zone {
            width: 90vw;
            max-width: 800px;
            min-height: 400px;
            border: 4px dashed rgba(255, 255, 255, 0.3);
            border-radius: 30px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 3rem;
            cursor: pointer;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
        }

        .upload-zone:hover,
        .upload-zone.dragover {
            border-color: rgba(255, 215, 0, 0.8);
            background: rgba(255, 215, 0, 0.1);
            transform: scale(1.02);
        }

        .upload-icon {
            font-size: 8rem;
            margin-bottom: 2rem;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }

        .upload-text {
            font-size: 1.8rem;
            margin-bottom: 1rem;
            font-weight: bold;
        }

        .upload-hint {
            font-size: 1.2rem;
            opacity: 0.7;
            margin-bottom: 2rem;
        }

        .btn-upload {
            background: linear-gradient(135deg, #9b59b6, #8e44ad);
            color: white;
            border: none;
            padding: 1.5rem 3rem;
            font-size: 1.3rem;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 10px 30px rgba(155, 89, 182, 0.4);
        }

        .btn-upload:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(155, 89, 182, 0.6);
        }

        #fileInput {
            display: none;
        }

        .gallery {
            width: 90vw;
            max-width: 1200px;
            margin-top: 3rem;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 2rem;
        }

        .gallery-item {
            position: relative;
            aspect-ratio: 1;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            transition: transform 0.3s ease;
        }

        .gallery-item:hover {
            transform: scale(1.05);
        }

        .gallery-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .delete-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(231, 76, 60, 0.9);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .gallery-item:hover .delete-btn {
            opacity: 1;
        }

        .delete-btn:hover {
            background: rgba(192, 57, 43, 1);
        }

        .counter {
            position: fixed;
            top: 2rem;
            right: 2rem;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(10px);
            padding: 1rem 2rem;
            border-radius: 50px;
            font-size: 1.2rem;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
        }

        .actions {
            margin-top: 2rem;
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            justify-content: center;
        }

        .btn-action {
            background: rgba(52, 152, 219, 0.8);
            color: white;
            border: 2px solid rgba(52, 152, 219, 1);
            padding: 1rem 2rem;
            font-size: 1.1rem;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-action:hover {
            background: rgba(52, 152, 219, 1);
            transform: translateY(-3px);
        }

        .btn-view {
            background: rgba(46, 204, 113, 0.8);
            border-color: rgba(46, 204, 113, 1);
        }

        .btn-view:hover {
            background: rgba(46, 204, 113, 1);
        }

        .btn-clear {
            background: rgba(231, 76, 60, 0.8);
            border-color: rgba(231, 76, 60, 1);
        }

        .btn-clear:hover {
            background: rgba(231, 76, 60, 1);
        }

        .empty-message {
            text-align: center;
            opacity: 0.5;
            font-size: 1.3rem;
            margin-top: 2rem;
        }
    </style>
</head>
<body>
    <h1>üì§ Upload de Mandalas</h1>
    <p class="subtitle">Ajoutez autant de mandalas que vous voulez</p>

    <div class="counter" id="counter">0 mandala(s)</div>

    <label for="fileInput" class="upload-zone" id="uploadZone">
        <div class="upload-icon">üïâÔ∏è</div>
        <div class="upload-text">Glissez vos mandalas ici</div>
        <div class="upload-hint">ou cliquez pour s√©lectionner plusieurs fichiers</div>
        <button type="button" class="btn-upload" onclick="document.getElementById('fileInput').click()">
            Choisir des fichiers
        </button>
        <input type="file" id="fileInput" accept="image/*" multiple>
    </label>

    <div class="actions">
        <button class="btn-action btn-view" onclick="viewMandalas()">
            üëÅÔ∏è Voir en mode contemplation
        </button>
        <button class="btn-action btn-clear" onclick="clearAll()">
            üóëÔ∏è Tout effacer
        </button>
    </div>

    <div class="gallery" id="gallery"></div>

    <script>
        let images = [];

        // Initialisation
        document.addEventListener('DOMContentLoaded', () => {
            loadImages();
            updateDisplay();
            setupListeners();
        });

        function setupListeners() {
            const fileInput = document.getElementById('fileInput');
            const uploadZone = document.getElementById('uploadZone');

            fileInput.addEventListener('change', handleFiles);

            // Drag & Drop
            uploadZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadZone.classList.add('dragover');
            });

            uploadZone.addEventListener('dragleave', () => {
                uploadZone.classList.remove('dragover');
            });

            uploadZone.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadZone.classList.remove('dragover');
                const files = e.dataTransfer.files;
                handleFiles({ target: { files } });
            });
        }

        function handleFiles(e) {
            const files = e.target.files;
            if (!files || files.length === 0) return;

            let loadedCount = 0;
            const totalFiles = files.length;

            Array.from(files).forEach(file => {
                if (!file.type.startsWith('image/')) return;

                const reader = new FileReader();
                reader.onload = (event) => {
                    images.push({
                        data: event.target.result,
                        name: file.name,
                        id: Date.now() + Math.random()
                    });

                    loadedCount++;
                    if (loadedCount === totalFiles) {
                        saveImages();
                        updateDisplay();

                        // Animation de succ√®s
                        showNotification(`‚úÖ ${totalFiles} image(s) ajout√©e(s) !`);
                    }
                };
                reader.readAsDataURL(file);
            });

            // Reset input
            e.target.value = '';
        }

        function saveImages() {
            try {
                localStorage.setItem('mandalaImages', JSON.stringify(images.map(img => img.data)));
            } catch (e) {
                // Si trop grand, garder seulement les 30 derni√®res
                images = images.slice(-30);
                localStorage.setItem('mandalaImages', JSON.stringify(images.map(img => img.data)));
                showNotification('‚ö†Ô∏è Limite atteinte, anciennes images supprim√©es');
            }
        }

        function loadImages() {
            const stored = localStorage.getItem('mandalaImages');
            if (stored) {
                const data = JSON.parse(stored);
                images = data.map((img, i) => ({
                    data: img,
                    name: `Mandala ${i + 1}`,
                    id: Date.now() + i
                }));
            }
        }

        function updateDisplay() {
            const gallery = document.getElementById('gallery');
            const counter = document.getElementById('counter');

            counter.textContent = `${images.length} mandala(s)`;

            if (images.length === 0) {
                gallery.innerHTML = '<div class="empty-message">Aucun mandala upload√© pour le moment</div>';
                return;
            }

            gallery.innerHTML = images.map((img, index) => `
                <div class="gallery-item">
                    <img src="${img.data}" alt="${img.name}">
                    <button class="delete-btn" onclick="deleteImage(${index})">√ó</button>
                </div>
            `).join('');
        }

        function deleteImage(index) {
            if (confirm('Supprimer ce mandala ?')) {
                images.splice(index, 1);
                saveImages();
                updateDisplay();
                showNotification('üóëÔ∏è Mandala supprim√©');
            }
        }

        function clearAll() {
            if (confirm(`Supprimer tous les ${images.length} mandalas ?`)) {
                images = [];
                localStorage.removeItem('mandalaImages');
                updateDisplay();
                showNotification('üóëÔ∏è Tous les mandalas supprim√©s');
            }
        }

        function viewMandalas() {
            if (images.length === 0) {
                alert('Veuillez d\'abord uploader des mandalas !');
                return;
            }
            window.location.href = 'mandala.html';
        }

        function showNotification(message) {
            const notif = document.createElement('div');
            notif.textContent = message;
            notif.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: rgba(0, 0, 0, 0.9);
                color: white;
                padding: 2rem 3rem;
                border-radius: 20px;
                font-size: 1.5rem;
                z-index: 10000;
                box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
                animation: fadeInOut 2s ease;
            `;

            const style = document.createElement('style');
            style.textContent = `
                @keyframes fadeInOut {
                    0%, 100% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
                    10%, 90% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
                }
            `;
            document.head.appendChild(style);

            document.body.appendChild(notif);
            setTimeout(() => notif.remove(), 2000);
        }
    </script>
</body>
</html>
