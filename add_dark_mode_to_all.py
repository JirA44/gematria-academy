#!/usr/bin/env python3
"""
Script pour ajouter le bouton mode nuit et le script JavaScript
√† toutes les pages HTML qui ne l'ont pas encore.
"""

import os
import re

# Liste des pages √† mettre √† jour
pages_to_update = [
    "runes-debutant.html",
    "runes-intermediaire.html",
    "runes-expert.html",
    "gematria-debutant.html",
    "gematria-intermediaire.html",
    "gematria-expert.html"
]

# Bouton mode nuit √† ins√©rer dans le header
dark_mode_button = '        <button class="dark-mode-toggle" onclick="toggleDarkMode()">üåô Mode Nuit</button>\n'

# Script JavaScript √† ins√©rer avant </body>
dark_mode_script = '''
    <script>
        // Mode Nuit
        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            const isDark = document.body.classList.contains('dark-mode');
            localStorage.setItem('darkMode', isDark);
            const btn = document.querySelector('.dark-mode-toggle');
            btn.textContent = isDark ? '‚òÄÔ∏è Mode Jour' : 'üåô Mode Nuit';
        }

        // Charger la pr√©f√©rence au d√©marrage
        window.addEventListener('DOMContentLoaded', () => {
            const isDark = localStorage.getItem('darkMode') === 'true';
            if (isDark) {
                document.body.classList.add('dark-mode');
                const btn = document.querySelector('.dark-mode-toggle');
                if (btn) btn.textContent = '‚òÄÔ∏è Mode Jour';
            }
        });
    </script>
'''

def add_dark_mode_to_file(filepath):
    """Ajoute le mode nuit √† un fichier HTML"""
    print(f"Traitement de {filepath}...")

    try:
        with open(filepath, 'r', encoding='utf-8') as f:
            content = f.read()

        # V√©rifier si le mode nuit est d√©j√† pr√©sent
        if 'dark-mode-toggle' in content:
            print(f"  ‚úì {filepath} a d√©j√† le mode nuit")
            return False

        # Ajouter le bouton dans le header
        # Chercher le pattern <header>\n et ajouter le bouton apr√®s
        header_pattern = r'(<header>)\s*\n'
        if re.search(header_pattern, content):
            content = re.sub(header_pattern, r'\1\n' + dark_mode_button, content)
            print(f"  ‚úì Bouton ajout√© au header")
        else:
            print(f"  ‚ö†Ô∏è  Pattern header non trouv√©")
            return False

        # Ajouter le script avant </body>
        body_pattern = r'(</body>)'
        if re.search(body_pattern, content):
            content = re.sub(body_pattern, dark_mode_script + r'\n\1', content)
            print(f"  ‚úì Script ajout√© avant </body>")
        else:
            print(f"  ‚ö†Ô∏è  Balise </body> non trouv√©e")
            return False

        # Sauvegarder le fichier
        with open(filepath, 'w', encoding='utf-8') as f:
            f.write(content)

        print(f"  ‚úÖ {filepath} mis √† jour avec succ√®s!")
        return True

    except Exception as e:
        print(f"  ‚ùå Erreur: {e}")
        return False

def main():
    """Fonction principale"""
    script_dir = os.path.dirname(os.path.abspath(__file__))
    updated_count = 0

    print("=" * 60)
    print("Ajout du mode nuit aux pages HTML")
    print("=" * 60)

    for page in pages_to_update:
        filepath = os.path.join(script_dir, page)

        if not os.path.exists(filepath):
            print(f"‚ö†Ô∏è  {page} n'existe pas")
            continue

        if add_dark_mode_to_file(filepath):
            updated_count += 1
        print()

    print("=" * 60)
    print(f"R√©sum√©: {updated_count} page(s) mise(s) √† jour")
    print("=" * 60)

    if updated_count > 0:
        print("\n‚úÖ Mode nuit ajout√© avec succ√®s!")
        print("Testez en ouvrant les pages dans votre navigateur.")
    else:
        print("\n‚ÑπÔ∏è  Aucune page n'a √©t√© modifi√©e (d√©j√† √† jour ou erreurs)")

if __name__ == "__main__":
    main()
