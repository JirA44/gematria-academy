# Script de mise √† jour automatique du site Gematria Academy
# Ex√©cut√© toutes les heures par le planificateur de t√¢ches Windows

$repoPath = "D:\Apprentissage_Runes_Gematria"
$logFile = "$repoPath\auto_update.log"

# Fonction de log
function Write-Log {
    param($message)
    $timestamp = Get-Date -Format "yyyy-MM-dd HH:mm:ss"
    "$timestamp - $message" | Out-File -Append -FilePath $logFile
}

try {
    Write-Log "=== D√©marrage de la mise √† jour automatique ==="

    # Se d√©placer dans le r√©pertoire
    Set-Location $repoPath

    # V√©rifier s'il y a des changements
    $status = git status --porcelain

    if ($status) {
        Write-Log "Changements d√©tect√©s, d√©but du commit..."

        # Ajouter tous les fichiers
        git add .

        # Cr√©er le commit avec un message horodat√©
        $commitMessage = "üîÑ Mise √† jour automatique - $(Get-Date -Format 'yyyy-MM-dd HH:mm')"
        git commit -m $commitMessage

        Write-Log "Commit cr√©√©: $commitMessage"

        # Pousser vers GitHub
        git push origin main

        Write-Log "‚úÖ Push vers GitHub r√©ussi!"
        Write-Log "‚è±Ô∏è Cloudflare Pages va d√©ployer dans 1-2 minutes"
    }
    else {
        Write-Log "Aucun changement d√©tect√©, pas de mise √† jour n√©cessaire"
    }

    Write-Log "=== Fin de la mise √† jour automatique ==="
}
catch {
    Write-Log "‚ùå ERREUR: $_"
}
